{
  "nodes": [
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -608,
        -48
      ],
      "id": "f40d7602-f007-4aeb-88eb-8dfc8cab49b1",
      "name": "OpenAI Chat Model2",
      "credentials": {
        "openAiApi": {
          "id": "7T43mFUrWSK1b37h",
          "name": "Nueva OPENAI"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "categorias",
        "returnAll": true
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        -224,
        -48
      ],
      "id": "52435922-f79f-40d8-b277-ecddfa0698d1",
      "name": "consultar_categorias",
      "credentials": {
        "supabaseApi": {
          "id": "W8gqsCw5s1YHm5SZ",
          "name": "Supabase Me LLEVO ESTO"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=El usuario necesita crear un producto que se llama {{ $json.nombre_producto }} debes crear todo el producto, todo totalmente funcional, el producto trata sobre {{ $json.De_que_trata_el_producto }} y el precio es de {{ $json.precio }} y las caracteristicas son estas {{ $json.caracteristicas }}",
        "options": {
          "systemMessage": "=Eres un asistente amigable que ayuda a crear productos para e-commerce.\n\n## IMPORTANTE: Responde SIEMPRE de manera conversacional y natural\n\n### MODO NORMAL (predeterminado):\n- Habla como una persona normal, amigable y profesional\n- Haz preguntas para conocer el producto que quiere crear\n- Pregunta por: nombre, descripci√≥n, precio, caracter√≠sticas, etc.\n- NO uses formato t√©cnico ni JSON\n- Responde en texto normal y conversacional\n\n### INFORMACI√ìN QUE NECESITAS:\n- Nombre del producto\n- Descripci√≥n b√°sica\n- Precio aproximado\n- Caracter√≠sticas principales\n- Beneficios clave\n- Te llegara una informacion del producto como: El nombre del producto:{{ $json.nombre_producto }} el precio: {{ $json.precio }} , te que trata el producto: {{ $json.De_que_trata_el_producto }} , caracteristicas del producto {{ $json.caracteristicas }} en base a esta informacion crea todo\n\n### REGLAS CR√çTICAS PARA DIMENSIONES Y PUNTOS DE DOLOR:\n1. **Las dimensiones deben ser realistas** y apropiadas para el tipo de producto espec√≠fico:\n   - Electr√≥nicos peque√±os (auriculares, cargadores): 5-15cm\n   - Ropa: usar medidas est√°ndar de tallas\n   - Libros: aproximadamente 20x15x2cm\n   - Productos de belleza: 5-20cm seg√∫n el tipo\n   - Electrodom√©sticos: 30-100cm seg√∫n tama√±o\n   - Accesorios: 10-30cm\n   - Siempre considera el peso realista en gramos\n2. **Los puntos de dolor siguen una l√≥gica espec√≠fica**: ID 1-2 describen PROBLEMAS del cliente, ID 3-4 presentan SOLUCIONES que ofrece el producto\n3. **Genera contenido espec√≠fico y relevante** para cada campo, evita texto placeholder o gen√©rico\n\n### SOLO cuando el usuario diga expl√≠citamente \"crear el producto\", \"generar\", \"ya est√° listo\" o similar:\n\n**PASO 1: CONSULTAR CATEGOR√çAS**\nOBLIGATORIO!! Antes de generar el JSON para crear un producto , SIEMPRE usa la herramienta \"consultar_categorias\" para obtener las categor√≠as disponibles y seleccionar la m√°s apropiada para el producto.\n\n**PASO 2: GENERAR JSON**\nEntonces S√ç responde √öNICAMENTE con este JSON (USANDO SOLO LOS CAMPOS REALES DE LA BASE DE DATOS):\n\n```json\n{\n  \"nombre\": \"Nombre atractivo y comercial del producto\",\n  \"slug\": \"url-amigable-del-producto\",\n  \"descripcion\": \"Descripci√≥n detallada y persuasiva (m√≠nimo 200 palabras)\",\n  \"ganchos\": [\"üî• Gancho 1\", \"‚ö° Gancho 2\", \"üéØ Gancho 3\", \"üíé Gancho 4\", \"üöÄ Gancho 5\"],\n  \"beneficios\": [\"Beneficio espec√≠fico 1\", \"Beneficio espec√≠fico 2\", \"Beneficio espec√≠fico 3\", \"Beneficio espec√≠fico 4\", \"Beneficio espec√≠fico 5\"],\n  \"ventajas\": [\"Ventaja competitiva 1\", \"Ventaja competitiva 2\", \"Ventaja competitiva 3\", \"Ventaja competitiva 4\"],\n  \"precio\": 789000,\n  \"precio_original\": 1183650,\n  \"descuento\": 33,\n  \"estado\": \"nuevo\",\n  \"categoria_id\": \"976d85fe-f4f1-4e19-8c19-fdfb940a0860\",\n  \"stock\": 50,\n  \"stock_minimo\": 5,\n  \"landing_tipo\": \"temu\",\n  \"destacado\": false,\n  \"activo\": true,\n  \"peso\": 2500,\n  \"dimensiones\": {\"alto\": 30, \"ancho\": 25, \"profundidad\": 15},\n  \"marca\": \"Marca Premium\",\n  \"modelo\": \"Modelo Profesional X1\",\n  \"color\": \"Color Principal\",\n  \"talla\": \"√önica\",\n  \"material\": \"Material de Alta Calidad\",\n  \"garantia_meses\": 24,\n  \"origen_pais\": \"Colombia\",\n  \"palabras_clave\": [\"palabra1\", \"palabra2\", \"palabra3\", \"palabra4\", \"palabra5\", \"palabra6\", \"palabra7\", \"palabra8\", \"palabra9\", \"palabra10\"],\n  \"meta_title\": \"T√≠tulo SEO optimizado (m√°ximo 60 caracteres)\",\n  \"meta_description\": \"Descripci√≥n SEO persuasiva (m√°ximo 160 caracteres)\",\n  \"banner_animado\": {\n    \"mensajes\": [\"üöö Env√≠o gratis a toda Colombia\", \"üí≥ Pago 100% seguro\", \"üõ°Ô∏è Garant√≠a total\", \"‚ö° Oferta limitada\"],\n    \"textColor\": \"#FFFFFF\",\n    \"velocidad\": \"normal\",\n    \"backgroundColor\": \"#FF4444\"\n  },\n  \"puntos_dolor\": {\n    \"titulo\": \"¬øTe sientes identificado con estos problemas?\",\n    \"subtitulo\": \"Miles de personas sufren estos inconvenientes cada d√≠a\",\n    \"timeline\": [\n      {\n        \"id\": 1,\n        \"icono\": \"üíî\",\n        \"nombre\": \"Problema Principal 1\",\n        \"posicion\": \"izquierda\",\n        \"solucion\": \"Descripci√≥n clara del primer problema que enfrenta el cliente\",\n        \"textoBoton\": \"Aqui pones un boton que vaya acordeon con este id\",\n        \"descripcion\": \"Explicaci√≥n detallada del dolor o frustraci√≥n espec√≠fica del cliente\"\n      },\n      {\n        \"id\": 2,\n        \"icono\": \"üò§\",\n        \"nombre\": \"Problema Principal 2\",\n        \"posicion\": \"derecha\",\n        \"solucion\": \"Descripci√≥n clara del segundo problema que enfrenta el cliente\",\n        \"textoBoton\": \"Aqui pones un boton que vaya acordeon con este id\",\n        \"descripcion\": \"Explicaci√≥n detallada del segundo dolor o frustraci√≥n del cliente\"\n      },\n      {\n        \"id\": 3,\n        \"icono\": \"‚úÖ\",\n        \"nombre\": \"Nuestra Soluci√≥n 1\",\n        \"posicion\": \"izquierda\",\n        \"solucion\": \"C√≥mo nuestro producto resuelve espec√≠ficamente el primer problema\",\n        \"textoBoton\": \"Aqui pones un boton que vaya acordeon con este id\",\n        \"descripcion\": \"Explicaci√≥n detallada de c√≥mo el producto elimina el primer dolor\"\n      },\n      {\n        \"id\": 4,\n        \"icono\": \"üéØ\",\n        \"nombre\": \"Nuestra Soluci√≥n 2\",\n        \"posicion\": \"derecha\",\n        \"solucion\": \"C√≥mo nuestro producto resuelve espec√≠ficamente el segundo problema\",\n        \"textoBoton\": \"Aqui pones un boton que vaya acordeon con este id, el texto acordeon a lo que dice el ID\",\n        \"descripcion\": \"Explicaci√≥n detallada de c√≥mo el producto elimina el segundo dolor\"\n      }\n    ]\n  },\n  \"caracteristicas\": {\n    \"titulo\": \"¬øPor qu√© miles eligen nuestro producto?\",\n    \"subtitulo\": \"Caracter√≠sticas que lo hacen √∫nico\",\n    \"cta\": {\n      \"texto\": \"¬°QUIERO APROVECHAR ESTA OFERTA!\",\n      \"subtexto\": \"üî• Stock limitado, no dejes pasar esta oportunidad\"\n    },\n    \"imagen\": \"\",\n    \"detalles\": [\n      {\n        \"id\": 1,\n        \"icono\": \"‚ö°\",\n        \"titulo\": \"Caracter√≠stica Premium 1\",\n        \"descripcion\": \"Descripci√≥n detallada de la caracter√≠stica 1\"\n      },\n      {\n        \"id\": 2,\n        \"icono\": \"üîß\",\n        \"titulo\": \"Caracter√≠stica Premium 2\",\n        \"descripcion\": \"Descripci√≥n detallada de la caracter√≠stica 2\"\n      },\n      {\n        \"id\": 3,\n        \"icono\": \"üíé\",\n        \"titulo\": \"Caracter√≠stica Premium 3\",\n        \"descripcion\": \"Descripci√≥n detallada de la caracter√≠stica 3\"\n      }\n    ],\n    \"beneficios\": [\n      {\n        \"id\": 1,\n        \"icono\": \"üõ°Ô∏è\",\n        \"titulo\": \"Beneficio Clave 1\",\n        \"descripcion\": \"Descripci√≥n del beneficio 1\"\n      },\n      {\n        \"id\": 2,\n        \"icono\": \"üöö\",\n        \"titulo\": \"Beneficio Clave 2\",\n        \"descripcion\": \"Descripci√≥n del beneficio 2\"\n      },\n      {\n        \"id\": 3,\n        \"icono\": \"üí∞\",\n        \"titulo\": \"Beneficio Clave 3\",\n        \"descripcion\": \"Descripci√≥n del beneficio 3\"\n      }\n    ]\n  },\n  \"testimonios\": {\n    \"titulo\": \"¬°+15.847 YA COMPRARON ESTE PRODUCTO!\",\n    \"subtitulo\": \"Lee lo que dicen nuestros clientes colombianos satisfechos\",\n    \"testimonios\": [\n      {\n        \"id\": 1,\n        \"fecha\": \"Hace 2 d√≠as\",\n        \"likes\": 234,\n        \"nombre\": \"Mar√≠a Gonz√°lez\",\n        \"rating\": 5,\n        \"ubicacion\": \"Bogot√°, Colombia\",\n        \"comentario\": \"Excelente producto, super√≥ mis expectativas. Lo recomiendo 100% ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê\",\n        \"verificado\": true,\n        \"compraVerificada\": true\n      },\n      {\n        \"id\": 2,\n        \"fecha\": \"Hace 1 semana\",\n        \"likes\": 189,\n        \"nombre\": \"Carlos Rodr√≠guez\",\n        \"rating\": 5,\n        \"ubicacion\": \"Medell√≠n, Colombia\",\n        \"comentario\": \"Incre√≠ble calidad y lleg√≥ s√∫per r√°pido. Vale cada peso invertido ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê\",\n        \"verificado\": true,\n        \"compraVerificada\": true\n      },\n      {\n        \"id\": 3,\n        \"fecha\": \"Hace 3 d√≠as\",\n        \"likes\": 156,\n        \"nombre\": \"Ana L√≥pez\",\n        \"rating\": 4,\n        \"ubicacion\": \"Cali, Colombia\",\n        \"comentario\": \"Muy buen producto, cumple lo prometido. Servicio al cliente excelente ‚≠ê‚≠ê‚≠ê‚≠ê\",\n        \"verificado\": true,\n        \"compraVerificada\": true\n      }\n    ],\n    \"estadisticas\": {\n      \"recomiendan\": 98,\n      \"satisfaccion\": 4.9,\n      \"totalClientes\": 159\n    }\n  },\n  \"faq\": {\n    \"titulo\": \"Preguntas Frecuentes\",\n    \"subtitulo\": \"Resolvemos todas tus dudas para que compres con total confianza\",\n    \"preguntas\": [\n      {\n        \"pregunta\": \"¬øCu√°nto tiempo tarda en llegar?\",\n        \"respuesta\": \"El env√≠o tarda entre 1-3 d√≠as h√°biles a nivel nacional.\"\n      },\n      {\n        \"pregunta\": \"¬øTiene garant√≠a?\",\n        \"respuesta\": \"S√≠, incluye garant√≠a de 24 meses por defectos de fabricaci√≥n.\"\n      },\n      {\n        \"pregunta\": \"¬øPuedo devolverlo si no me gusta?\",\n        \"respuesta\": \"Tienes 30 d√≠as para devolverlo sin preguntas si no est√°s satisfecho.\"\n      }\n    ]\n  },\n  \"garantias\": {\n    \"titulo\": \"Compra con Total Confianza\",\n    \"subtitulo\": \"Tu satisfacci√≥n y seguridad son nuestra prioridad #1\",\n    \"garantias\": [\n      {\n        \"icono\": \"üõ°Ô∏è\",\n        \"titulo\": \"Garant√≠a de Calidad\",\n        \"descripcion\": \"24 meses de garant√≠a por defectos de fabricaci√≥n\"\n      },\n      {\n        \"icono\": \"üöö\",\n        \"titulo\": \"Env√≠o Seguro\",\n        \"descripcion\": \"Env√≠o gratis y seguro a toda Colombia\"\n      },\n      {\n        \"icono\": \"üí∞\",\n        \"titulo\": \"Devoluci√≥n del Dinero\",\n        \"descripcion\": \"30 d√≠as para devolver si no est√°s satisfecho\"\n      }\n    ]\n  },\n  \"cta_final\": {\n    \"titulo\": \"¬°NO DEJES PASAR ESTA OPORTUNIDAD!\",\n    \"subtitulo\": \"Aprovecha esta oferta exclusiva antes de que se agote\",\n    \"envio\": \"üöö Env√≠o GRATIS en 24-48 horas\",\n    \"garantia\": \"üõ°Ô∏è Garant√≠a de satisfacci√≥n del 100% o te devolvemos tu dinero\",\n    \"urgencia\": \"‚ö° Oferta v√°lida solo por hoy\",\n    \"descuento\": \"70% OFF\",\n    \"botonTexto\": \"¬°QUIERO MI TRANSFORMACI√ìN AHORA!\",\n    \"precioActual\": \"\",\n    \"precioAnterior\": \"\"\n  },\n  \"numero_de_ventas\": 185,\n  \"calificacion_promedio\": 4.8,\n  \"total_resenas\": 95,\n  \"promociones\": [\n    {\n      \"tipo\": \"multipack\",\n      \"multiplicador\": 2,\n      \"titulo\": \"Ll√©vate 2 con 15% OFF\",\n      \"descripcion\": \"Aplica para todas las tallas\",\n      \"activo\": true,\n      \"desde\": \"2025-01-01\",\n      \"hasta\": \"2025-12-31\"\n    }\n  ]\n}\n```\n\nTodo debe ser muy persuasivo y poderoso, y cuando termines de crear el producto le das a el usuario el link del producto el cual es: https://mellevoesto.com/producto/acalaurldelproductocreado... \n\n## REGLAS CR√çTICAS:\n1. Responde SOLO con el JSON, sin texto adicional\n2. NO uses markdown ni explicaciones\n3. Todos los campos son obligatorios\n4. Los precios deben ser n√∫meros enteros (sin decimales)\n5. Los arrays y objetos deben estar correctamente formateados\n6. Adapta el contenido al producto espec√≠fico que describe el usuario\n7. Mant√©n el formato exacto del JSON\n8. USA SOLO LOS CAMPOS QUE EXISTEN EN LA BASE DE DATOS REAL\n9. NO incluyas campos como 'id', 'fotos_principales', 'fotos_secundarias' que no existen\n10. INCLUYE todos los campos reales: ventajas, precio_original, stock_minimo, landing_tipo, destacado, activo, peso, total_resenas\n\nSi el usuario no proporciona informaci√≥n suficiente, pregunta espec√≠ficamente qu√© necesitas para crear el producto.\n\nUSO DE HERRAMIENTAS, consulta la herramienta disponible llamada CONSULTAR CATEGORIAS, para saber a que categoria agregar el nuevo producto creado "
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -464,
        -400
      ],
      "id": "98c6f448-6389-436c-8d76-6687563303ac",
      "name": "AI Agent Creador Productos"
    },
    {
      "parameters": {
        "jsCode": "// DETECTOR CORREGIDO - BUSCA JSON DENTRO DE RESPUESTAS CONVERSACIONALES\nconsole.log('üîç ANALIZANDO RESPUESTA DEL AI AGENT');\n\nconst respuestaAgent = $input.first();\nlet respuestaTexto = '';\n\n// Extraer la respuesta del AI Agent\nif (respuestaAgent.json && respuestaAgent.json.output) {\n  respuestaTexto = String(respuestaAgent.json.output).trim();\n} else if (respuestaAgent.json && respuestaAgent.json.text) {\n  respuestaTexto = String(respuestaAgent.json.text).trim();\n} else if (respuestaAgent.json) {\n  respuestaTexto = JSON.stringify(respuestaAgent.json);\n} else {\n  respuestaTexto = String(respuestaAgent).trim();\n}\n\nconsole.log('üìù Respuesta completa:', respuestaTexto.substring(0, 200) + '...');\nconsole.log('üìè Longitud:', respuestaTexto.length);\n\n// DETECCI√ìN ROBUSTA DE JSON DE PRODUCTO\nlet esProductoJSON = false;\nlet objetoProducto = null;\nlet razonDeteccion = '';\n\n// Solo procesar si tiene contenido sustancial\nif (respuestaTexto.length > 50) {\n  \n  // NUEVA L√ìGICA: Buscar JSON dentro del texto (incluso si hay texto conversacional)\n  let jsonExtraido = null;\n  \n  // M√©todo 1: Buscar JSON entre ```json y ```\n  const matchCodeBlock = respuestaTexto.match(/```json\\s*([\\s\\S]*?)\\s*```/);\n  if (matchCodeBlock && matchCodeBlock[1]) {\n    console.log('üîç JSON encontrado en bloque de c√≥digo');\n    try {\n      jsonExtraido = JSON.parse(matchCodeBlock[1].trim());\n    } catch (error) {\n      console.log('‚ùå Error parseando JSON del bloque:', error.message);\n    }\n  }\n  \n  // M√©todo 2: Buscar JSON que empiece con { y termine con } (m√°s robusto)\n  if (!jsonExtraido) {\n    const inicioJSON = respuestaTexto.indexOf('{');\n    const finJSON = respuestaTexto.lastIndexOf('}');\n    \n    if (inicioJSON !== -1 && finJSON !== -1 && finJSON > inicioJSON) {\n      const posibleJSON = respuestaTexto.substring(inicioJSON, finJSON + 1);\n      console.log('üîç Posible JSON encontrado en posici√≥n', inicioJSON, 'a', finJSON);\n      \n      try {\n        jsonExtraido = JSON.parse(posibleJSON);\n        console.log('‚úÖ JSON parseado exitosamente');\n      } catch (error) {\n        console.log('‚ùå Error parseando JSON extra√≠do:', error.message);\n      }\n    }\n  }\n  \n  // M√©todo 3: Verificar si toda la respuesta es JSON\n  if (!jsonExtraido && respuestaTexto.startsWith('{') && respuestaTexto.endsWith('}')) {\n    try {\n      jsonExtraido = JSON.parse(respuestaTexto);\n      console.log('‚úÖ Respuesta completa es JSON v√°lido');\n    } catch (error) {\n      console.log('‚ùå Error parseando respuesta completa como JSON:', error.message);\n    }\n  }\n  \n  // VALIDAR SI EL JSON EXTRA√çDO ES UN PRODUCTO\n  if (jsonExtraido) {\n    console.log('üîç Validando JSON extra√≠do...');\n    console.log('   - Tiene nombre:', !!jsonExtraido.nombre);\n    console.log('   - Tiene precio:', jsonExtraido.precio !== undefined);\n    console.log('   - Tiene descripcion:', !!jsonExtraido.descripcion);\n    \n    // Verificar campos m√≠nimos de producto\n    if (jsonExtraido.nombre && \n        (jsonExtraido.precio !== undefined) && \n        jsonExtraido.descripcion) {\n      \n      esProductoJSON = true;\n      objetoProducto = jsonExtraido;\n      razonDeteccion = 'JSON de producto v√°lido extra√≠do de respuesta';\n      \n      console.log('‚úÖ PRODUCTO DETECTADO:', jsonExtraido.nombre);\n      console.log('üí∞ Precio:', jsonExtraido.precio);\n      console.log('üìã Campos:', Object.keys(jsonExtraido).length);\n    } else {\n      razonDeteccion = 'JSON encontrado pero faltan campos de producto';\n      console.log('‚ùå JSON encontrado pero no es producto v√°lido');\n    }\n  } else {\n    razonDeteccion = 'No se encontr√≥ JSON v√°lido en la respuesta';\n    console.log('‚ùå No se pudo extraer JSON v√°lido');\n  }\n} else {\n  razonDeteccion = 'Respuesta muy corta - conversacional';\n  console.log('üìè Respuesta muy corta');\n}\n\nconsole.log('üéØ RESULTADO FINAL:');\nconsole.log('   - Es producto:', esProductoJSON);\nconsole.log('   - Raz√≥n:', razonDeteccion);\n\n// IMPORTANTE: El IF espera producto_detectado como STRING \"true\"\nreturn {\n  json: {\n    // Datos originales\n    output: respuestaAgent.json?.output || respuestaTexto,\n    \n    // CAMPO CLAVE PARA EL IF (como string \"true\" o \"false\")\n    producto_detectado: esProductoJSON ? \"true\" : \"false\",\n    \n    // Campos adicionales para informaci√≥n\n    es_producto_json: esProductoJSON,\n    es_conversacional: !esProductoJSON,\n    tipo_detectado: esProductoJSON ? 'producto_json' : 'conversacional',\n    razon_deteccion: razonDeteccion,\n    \n    // Producto parseado (si existe)\n    producto_objeto: objetoProducto,\n    \n    // Info de debugging\n    longitud_respuesta: respuestaTexto.length,\n    timestamp: new Date().toISOString()\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -160,
        -400
      ],
      "id": "fe705983-88c2-4152-b9f0-050c477fa846",
      "name": "Detector Tipo Respuesta"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "096d96a0-e72e-4339-9068-c3cde014bf46",
              "leftValue": "={{ $json.producto_detectado }}",
              "rightValue": "true",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "0cbb1f10-b081-40e4-b63b-bcd11fb8506c",
              "leftValue": "",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        64,
        -400
      ],
      "id": "62c1ba38-6b84-4d56-9c35-915bb4d36702",
      "name": "If"
    },
    {
      "parameters": {
        "jsCode": "// PROCESADOR JSON CORREGIDO - FUNCIONA CON EL DETECTOR ACTUALIZADO\nconsole.log('üîß PROCESADOR JSON - INICIANDO');\n\nconst respuestaAgent = $input.first();\nconsole.log('üì• Datos recibidos:', JSON.stringify(respuestaAgent, null, 2));\n\n// VERIFICAR SI DEBE PROCESAR (producto_detectado debe ser \"true\")\nif (respuestaAgent.json && respuestaAgent.json.producto_detectado !== \"true\") {\n  console.log('‚ö†Ô∏è SALTANDO PROCESAMIENTO - producto_detectado:', respuestaAgent.json.producto_detectado);\n  return {\n    json: {\n      mensaje: 'No es un producto JSON, saltando procesamiento',\n      producto_detectado: respuestaAgent.json.producto_detectado,\n      tipo_detectado: respuestaAgent.json.tipo_detectado || 'conversacional'\n    }\n  };\n}\n\nconsole.log('‚úÖ PROCESANDO PRODUCTO - producto_detectado es true');\n\n// EXTRAER EL PRODUCTO JSON DEL DETECTOR\nlet productoData = null;\n\n// El detector ahora pone el producto parseado en 'producto_objeto'\nif (respuestaAgent.json && respuestaAgent.json.producto_objeto) {\n  console.log('‚úÖ Usando producto_objeto del detector');\n  productoData = respuestaAgent.json.producto_objeto;\n}\n// Fallback: intentar parsear desde output\nelse if (respuestaAgent.json && respuestaAgent.json.output) {\n  console.log('üîÑ Parseando desde output');\n  try {\n    if (typeof respuestaAgent.json.output === 'string') {\n      productoData = JSON.parse(respuestaAgent.json.output);\n    } else {\n      productoData = respuestaAgent.json.output;\n    }\n  } catch (error) {\n    console.error('‚ùå Error parseando output:', error.message);\n  }\n}\n\nif (!productoData || !productoData.nombre) {\n  console.error('‚ùå No se pudo extraer producto v√°lido');\n  return {\n    json: {\n      error: 'No se pudo extraer producto v√°lido',\n      datos_disponibles: Object.keys(respuestaAgent.json || {}),\n      producto_objeto: respuestaAgent.json?.producto_objeto\n    }\n  };\n}\n\nconsole.log('üì¶ Producto extra√≠do:', productoData.nombre);\n\n// PROCESAR PARA SUPABASE - FORMATO DIRECTO\nconst producto = {\n  nombre: productoData.nombre,\n  slug: productoData.slug || productoData.nombre.toLowerCase().replace(/[^a-z0-9\\s-]/g, '').replace(/\\s+/g, '-'),\n  descripcion: productoData.descripcion,\n  ganchos: productoData.ganchos || [],\n  beneficios: productoData.beneficios || [],\n  precio: Number(productoData.precio) || 0,\n  precio_original: Number(productoData.precio_original) || Number(productoData.precio) * 1.5,\n  descuento: Number(productoData.descuento) || 0,\n  estado: productoData.estado || 'nuevo',\n  categoria_id: productoData.categoria_id || '976d85fe-f4f1-4e19-8c19-fdfb940a0860',\n  stock: Number(productoData.stock) || 50,\n  peso: Number(productoData.peso) || 2500,\n  dimensiones: productoData.dimensiones || { alto: 30, ancho: 25, profundidad: 15 },\n  marca: productoData.marca || 'Marca Premium',\n  modelo: productoData.modelo || 'Modelo Profesional',\n  color: productoData.color || 'Color Principal',\n  talla: productoData.talla || '√önica',\n  material: productoData.material || 'Material de Alta Calidad',\n  garantia_meses: Number(productoData.garantia_meses) || 24,\n  origen_pais: productoData.origen_pais || 'Colombia',\n  palabras_clave: productoData.palabras_clave || [],\n  meta_title: productoData.meta_title || productoData.nombre,\n  meta_description: productoData.meta_description || productoData.descripcion?.substring(0, 160),\n  banner_animado: productoData.banner_animado || { mensajes: [\"üöö Env√≠o gratis\", \"üí≥ Pago seguro\", \"üõ°Ô∏è Garant√≠a total\"] },\n  puntos_dolor: productoData.puntos_dolor || { titulo: \"Problemas\", subtitulo: \"Que resolvemos\", timeline: [] },\n  caracteristicas: productoData.caracteristicas || { titulo: \"Caracter√≠sticas\", subtitulo: \"Del producto\", detalles: [], beneficios: [], cta: { texto: \"¬°Comprar!\", subtexto: \"Oferta limitada\" } },\n  testimonios: productoData.testimonios || { titulo: \"Testimonios\", subtitulo: \"De clientes\", testimonios: [], estadisticas: { recomiendan: 95, satisfaccion: 4.5, totalClientes: 100 } },\n  faq: productoData.faq || { titulo: \"FAQ\", preguntas: [] },\n  garantias: productoData.garantias || { titulo: \"Garant√≠as\", garantias: [] },\n  cta_final: productoData.cta_final || { titulo: \"¬°Compra ahora!\", subtitulo: \"Oferta limitada\", botonTexto: \"Comprar\", precioActual: String(productoData.precio || 0), precioAnterior: String(productoData.precio_original || 0) },\n  promociones: productoData.promociones || { titulo: \"Promociones\", subtitulo: \"Especiales\", promociones: [] },\n  numero_de_ventas: Number(productoData.numero_de_ventas) || 185,\n  calificacion_promedio: Number(productoData.calificacion_promedio) || 4.8,\n  total_resenas: Number(productoData.total_resenas) || 95,\n  creado_el: new Date().toISOString(),\n  actualizado_el: new Date().toISOString()\n};\n\nconsole.log('‚úÖ PRODUCTO LISTO PARA SUPABASE:');\nconsole.log('   - Nombre:', producto.nombre);\nconsole.log('   - Precio:', producto.precio);\nconsole.log('   - Campos:', Object.keys(producto).length);\n\n// RETORNAR EN EL FORMATO QUE ESPERA SUPABASE\nreturn {\n  json: {\n    producto_procesado: producto\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        384,
        -400
      ],
      "id": "7538a790-98aa-403a-b67a-67160991f10d",
      "name": "Procesador JSON"
    },
    {
      "parameters": {
        "tableId": "productos",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "nombre",
              "fieldValue": "={{ $json.producto_procesado.nombre }}"
            },
            {
              "fieldId": "slug",
              "fieldValue": "={{ $json.producto_procesado.slug }}"
            },
            {
              "fieldId": "descripcion",
              "fieldValue": "={{ $json.producto_procesado.descripcion }}"
            },
            {
              "fieldId": "ganchos",
              "fieldValue": "={{ $json.producto_procesado.ganchos }}"
            },
            {
              "fieldId": "beneficios",
              "fieldValue": "={{ $json.producto_procesado.beneficios }}"
            },
            {
              "fieldId": "precio",
              "fieldValue": "={{ $json.producto_procesado.precio }}"
            },
            {
              "fieldId": "precio_original",
              "fieldValue": "={{ $json.producto_procesado.precio_original }}"
            },
            {
              "fieldId": "descuento",
              "fieldValue": "={{ $json.producto_procesado.descuento }}"
            },
            {
              "fieldId": "estado",
              "fieldValue": "={{ $json.producto_procesado.estado }}"
            },
            {
              "fieldId": "categoria_id",
              "fieldValue": "={{ $json.producto_procesado.categoria_id }}"
            },
            {
              "fieldId": "stock",
              "fieldValue": "={{ $json.producto_procesado.stock }}"
            },
            {
              "fieldId": "peso",
              "fieldValue": "={{ $json.producto_procesado.peso }}"
            },
            {
              "fieldId": "dimensiones",
              "fieldValue": "={{ $json.producto_procesado.dimensiones }}"
            },
            {
              "fieldId": "marca",
              "fieldValue": "={{ $json.producto_procesado.marca }}"
            },
            {
              "fieldId": "modelo",
              "fieldValue": "={{ $json.producto_procesado.modelo }}"
            },
            {
              "fieldId": "color",
              "fieldValue": "={{ $json.producto_procesado.color }}"
            },
            {
              "fieldId": "talla",
              "fieldValue": "={{ $json.producto_procesado.talla }}"
            },
            {
              "fieldId": "material",
              "fieldValue": "={{ $json.producto_procesado.material }}"
            },
            {
              "fieldId": "garantia_meses",
              "fieldValue": "={{ $json.producto_procesado.garantia_meses }}"
            },
            {
              "fieldId": "origen_pais",
              "fieldValue": "={{ $json.producto_procesado.origen_pais }}"
            },
            {
              "fieldId": "palabras_clave",
              "fieldValue": "={{ $json.producto_procesado.palabras_clave }}"
            },
            {
              "fieldId": "meta_title",
              "fieldValue": "={{ $json.producto_procesado.meta_title }}"
            },
            {
              "fieldId": "meta_description",
              "fieldValue": "={{ $json.producto_procesado.meta_description }}"
            },
            {
              "fieldId": "creado_el",
              "fieldValue": "={{ $json.producto_procesado.creado_el }}"
            },
            {
              "fieldId": "actualizado_el",
              "fieldValue": "={{ $json.producto_procesado.actualizado_el }}"
            },
            {
              "fieldId": "banner_animado",
              "fieldValue": "={{ $json.producto_procesado.banner_animado }}"
            },
            {
              "fieldId": "puntos_dolor",
              "fieldValue": "={{ $json.producto_procesado.puntos_dolor }}"
            },
            {
              "fieldId": "caracteristicas",
              "fieldValue": "={{ $json.producto_procesado.caracteristicas }}"
            },
            {
              "fieldId": "testimonios",
              "fieldValue": "={{ $json.producto_procesado.testimonios }}"
            },
            {
              "fieldId": "faq",
              "fieldValue": "={{ $json.producto_procesado.faq }}"
            },
            {
              "fieldId": "garantias",
              "fieldValue": "={{ $json.producto_procesado.garantias }}"
            },
            {
              "fieldId": "cta_final",
              "fieldValue": "={{ $json.producto_procesado.cta_final }}"
            },
            {
              "fieldId": "promociones",
              "fieldValue": "={{ $json.producto_procesado.promociones }}"
            },
            {
              "fieldId": "numero_de_ventas",
              "fieldValue": "={{ $json.producto_procesado.numero_de_ventas }}"
            },
            {
              "fieldId": "calificacion_promedio",
              "fieldValue": "={{ $json.producto_procesado.calificacion_promedio }}"
            },
            {
              "fieldId": "total_resenas",
              "fieldValue": "={{ $json.producto_procesado.total_resenas }}"
            },
            {
              "fieldId": "landing_tipo",
              "fieldValue": "temu"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        656,
        -384
      ],
      "id": "e5b6afc9-4aaf-41d5-8c3c-76c68deea19f",
      "name": "Crear Producto en Supabase",
      "credentials": {
        "supabaseApi": {
          "id": "W8gqsCw5s1YHm5SZ",
          "name": "Supabase Me LLEVO ESTO"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c586342b-cfdb-46e2-bbea-cf0cc7c9e69a",
              "name": "De_que_trata_el_producto",
              "value": "={{ $json.De_que_trata_el_producto }}",
              "type": "string"
            },
            {
              "id": "650ad3e2-de2c-42bf-9e03-903b5f96ed8e",
              "name": "precio",
              "value": "={{ $json.precio }}",
              "type": "string"
            },
            {
              "id": "d6efa320-ada7-4567-9edb-386ba76b88ad",
              "name": "nombre_producto",
              "value": "={{ $json.nombre_producto }}",
              "type": "string"
            },
            {
              "id": "bb2ce4ac-1309-4c4b-ab7b-5285d0b4da2b",
              "name": "caracteristicas",
              "value": "={{ $json.caracteristicas }}",
              "type": "string"
            },
            {
              "id": "12e82415-e9f3-43e1-96b9-c488e07de3af",
              "name": "nombre_del_usuario",
              "value": "={{ $json.nombre_del_usuario }}",
              "type": "string"
            },
            {
              "id": "6cf0d50d-535a-44bb-9722-4e157fbd9427",
              "name": "id_del_usuario",
              "value": "={{ $json.id_del_usuario }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -672,
        -400
      ],
      "id": "17d79760-dd0b-421e-ac79-8761bb0d1ef3",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "De_que_trata_el_producto"
            },
            {
              "name": "precio"
            },
            {
              "name": "nombre_producto"
            },
            {
              "name": "caracteristicas"
            }
          ]
        }
      },
      "id": "22985982-b8e2-47eb-ade6-7bb3310390dd",
      "typeVersion": 1.1,
      "name": "When Executed by Another Workflow",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "position": [
        -944,
        -400
      ]
    }
  ],
  "connections": {
    "OpenAI Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent Creador Productos",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "consultar_categorias": {
      "ai_tool": [
        [
          {
            "node": "AI Agent Creador Productos",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent Creador Productos": {
      "main": [
        [
          {
            "node": "Detector Tipo Respuesta",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Detector Tipo Respuesta": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Procesador JSON",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Procesador JSON": {
      "main": [
        [
          {
            "node": "Crear Producto en Supabase",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "AI Agent Creador Productos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "meta": {
    "instanceId": "8000b702e0a3d9ac6d70099a2751603316de4028cd14af0949776a26efecb219"
  }
}