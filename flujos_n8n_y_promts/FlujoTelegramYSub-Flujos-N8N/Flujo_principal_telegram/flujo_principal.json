{
  "nodes": [
    {
      "parameters": {
        "jsCode": "const respuestaSubida = items[0].json;\nconst datosTelegram = $('Disparador de Telegram').item.json;\nconst idArchivo = datosTelegram.message.photo[1].file_id;\nconst marcaTiempo = new Date().getTime();\nconst fecha = new Date().toISOString().split('T')[0];\n\n// Obtener el nombre del archivo desde la respuesta de Supabase\nlet nombreArchivoReal = respuestaSubida.Key || respuestaSubida.Id || respuestaSubida.path || `${fecha}/${marcaTiempo}-${idArchivo}.jpg`;\n\n// CORREGIR: Eliminar 'imagenes/' del inicio si ya est√° presente para evitar duplicaci√≥n\nif (nombreArchivoReal.startsWith('imagenes/')) {\n  nombreArchivoReal = nombreArchivoReal.replace('imagenes/', '');\n}\n\n// Generar URL p√∫blica correcta sin duplicar 'imagenes'\nconst urlPublica = `https://rrmafdbxvimmvcerwguy.supabase.co/storage/v1/object/public/imagenes/${nombreArchivoReal}`;\n\nreturn {\n  json: {\n    exito: true,\n    id: nombreArchivoReal,\n    nombre: nombreArchivoReal.split('/').pop(),\n    nombreArchivo: nombreArchivoReal,\n    rutaCompleta: nombreArchivoReal,\n    enlaceVisualizacion: urlPublica,\n    urlPublica: urlPublica,\n    Clave: nombreArchivoReal,\n    bucket: 'imagenes',\n    fechaSubida: new Date().toISOString(),\n    mensajeOriginal: datosTelegram.message.caption || '',\n    idChat: datosTelegram.message.chat.id\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1040,
        288
      ],
      "id": "0fbbdf9f-9150-4e60-a5fd-a1634eab908f",
      "name": "Procesar Info Upload"
    },
    {
      "parameters": {
        "description": "Llama a esta herramienta para combinar dos im√°genes. Debes pasar un prompt de generaci√≥n de imagen, los IDs de ambas im√°genes y un t√≠tulo para esta nueva imagen.",
        "workflowId": {
          "__rl": true,
          "value": "iFiOdpjfe2ezqXnm",
          "mode": "list",
          "cachedResultName": "combinar_imagenes"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "prompt": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('prompt', `El prompt de generaci√≥n de imagen. Debe estar optimizado para la generaci√≥n de im√°genes por IA y solo debe hacer referencia a las im√°genes como imagen1 e imagen2. Este prompt no debe contener \\\\n ni \"\".`, 'string') }}",
            "image1": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('imagen1', `El ID de la imagen 1`, 'string') }}",
            "image2": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('imagen2', `El ID de la imagen 2`, 'string') }}",
            "imageTitle": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('tituloImagen', `El t√≠tulo para la nueva imagen`, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "prompt",
              "displayName": "prompt",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "image1",
              "displayName": "image1",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "image2",
              "displayName": "image2",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "imageTitle",
              "displayName": "imageTitle",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        -240,
        928
      ],
      "id": "87b32c78-1b76-499f-a29c-192446ff2abf",
      "name": "combinar_imagenes1",
      "disabled": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://rrmafdbxvimmvcerwguy.supabase.co/storage/v1/object/imagenes/{{ $now.toUnixInteger() }}-{{ $json.result.file_id.replace(/[^a-zA-Z0-9]/g, '') }}.jpg",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "supabaseApi",
        "sendBody": true,
        "contentType": "binaryData",
        "inputDataFieldName": "data",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1248,
        288
      ],
      "id": "6d13b840-9a9a-4956-836b-7df038d3a4ba",
      "name": "Subir a Supabase",
      "credentials": {
        "supabaseApi": {
          "id": "W8gqsCw5s1YHm5SZ",
          "name": "Supabase Me LLEVO ESTO"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.message.text }}",
        "needsFallback": true,
        "options": {
          "systemMessage": "=AGENTE ORQUESTADOR - CREADOR DE PRODUCTOS GANADORES\n\nüéØ MISI√ìN: Agente maestro de ME LLEVO ESTO, especializado en productos de ecommerce ultra vendedores. Orquesta TODO el proceso de forma R√ÅPIDA y EFICIENTE.\n\nüó£Ô∏è PERSONALIDAD COLOMBIANA: Hablas como \"Mi hermano\", \"parcero\", \"¬°Chimba!\", \"¬°Verraco!\". DIRECTO, EFICIENTE, ORIENTADO A RESULTADOS. Respuestas en LENGUAJE NATURAL sin asteriscos ni caracteres especiales.\n\nüîß COMPORTAMIENTO OBLIGATORIO:\n1. SIEMPRE usa consultar_productos_optimizado AUTOM√ÅTICAMENTE cuando se mencione cualquier producto\n2. SIEMPRE valida datos ANTES de actuar\n3. SIEMPRE muestra datos reales al usuario\n4. SIEMPRE espera confirmaci√≥n expl√≠cita\n5. Solo entonces ejecuta la acci√≥n\n6. SIEMPRE confirma el resultado\n7. RESPONDE en lenguaje natural, SIN asteriscos, SIN caracteres especiales\n\nüö® REGLAS CR√çTICAS - USO AUTOM√ÅTICO DE HERRAMIENTAS:\n\n‚ö†Ô∏è CONSULTA AUTOM√ÅTICA OBLIGATORIA:\n- CUALQUIER menci√≥n de producto ‚Üí INMEDIATAMENTE usar consultar_productos_optimizado\n- CUALQUIER pregunta sobre producto ‚Üí PRIMERO consultar_productos_optimizado\n- CUALQUIER actualizaci√≥n ‚Üí PRIMERO consultar_productos_optimizado\n- CUALQUIER imagen ‚Üí PRIMERO consultar_productos_optimizado + buscar_imagenes\n- NUNCA responder sobre productos sin consultar primero\n- B√öSQUEDA FLEXIBLE: Busca con UNA SOLA PALABRA si es necesario\n\nüéØ MANEJO INTELIGENTE DE RESULTADOS DE B√öSQUEDA:\n- CUANDO consultar_productos_optimizado devuelva resultados:\n  1. NO mostrar TODA la informaci√≥n al usuario\n  2. FILTRAR y mostrar SOLO: ID + nombre del producto\n  3. CONFIRMAR: \"Encontr√© el producto [NOMBRE] con ID [ID]. ¬øEs este el correcto?\"\n  4. PREGUNTAR: \"¬øQu√© quieres hacer con este producto?\"\n  5. ESPERAR respuesta del usuario antes de continuar\n- OPCIONES COMUNES: \"editar\", \"ver detalles\", \"actualizar\", \"subir imagen\", etc.\n- SOLO despu√©s de confirmaci√≥n ‚Üí proceder con la acci√≥n solicitada\n\n‚ö†Ô∏è NUNCA EDITAR SIN ID REAL:\n- Para actualizar_productos: OBLIGATORIO consultar_productos_optimizado primero ‚Üí obtener UUID real\n- Para editar_imagen: OBLIGATORIO consultar_productos_optimizado + buscar_imagenes ‚Üí obtener UUID + imagen_id\n- PROHIBIDO hacer cualquier edici√≥n sin tener los IDs correctos\n- SIEMPRE mostrar los datos encontrados al usuario antes de proceder\n- SIEMPRE preguntar: \"¬øEs este el producto correcto que quieres editar?\"\n\nüö® FORMATOS OBLIGATORIOS PARA TODOS LOS CAMPOS:\n\n‚ö†Ô∏è FORMATO puntos_dolor - ESTRUCTURA EXACTA REQUERIDA:\n```json\n{\n  \"titulo\": \"Supera las Limitaciones de [Categor√≠a del Producto]\",\n  \"timeline\": [\n    {\n      \"id\": 1,\n      \"icono\": \"üò©\",\n      \"nombre\": \"Problema espec√≠fico real del usuario\",\n      \"posicion\": \"izquierda\",\n      \"solucion\": \"Descripci√≥n detallada de c√≥mo este producto espec√≠fico resuelve el problema. M√≠nimo 2 oraciones explicando la soluci√≥n.\",\n      \"textoBoton\": \"NUESTRA SOLUCI√ìN\",\n      \"descripcion\": \"Explicaci√≥n del dolor emocional que causa este problema al usuario.\"\n    },\n    {\n      \"id\": 2,\n      \"icono\": \"üòû\",\n      \"nombre\": \"Segundo problema espec√≠fico\",\n      \"posicion\": \"derecha\",\n      \"solucion\": \"Descripci√≥n detallada de la segunda soluci√≥n que ofrece el producto. M√≠nimo 2 oraciones.\",\n      \"textoBoton\": \"NUESTRA SOLUCI√ìN\",\n      \"descripcion\": \"Explicaci√≥n del segundo dolor emocional.\"\n    },\n    {\n      \"id\": 3,\n      \"icono\": \"üò§\",\n      \"nombre\": \"Tercer problema espec√≠fico\",\n      \"posicion\": \"izquierda\",\n      \"solucion\": \"Descripci√≥n detallada de la tercera soluci√≥n. M√≠nimo 2 oraciones.\",\n      \"textoBoton\": \"NUESTRA SOLUCI√ìN\",\n      \"descripcion\": \"Explicaci√≥n del tercer dolor emocional.\"\n    },\n    {\n      \"id\": 4,\n      \"icono\": \"üòî\",\n      \"nombre\": \"Cuarto problema espec√≠fico\",\n      \"posicion\": \"derecha\",\n      \"solucion\": \"Descripci√≥n detallada de la cuarta soluci√≥n. M√≠nimo 2 oraciones.\",\n      \"textoBoton\": \"NUESTRA SOLUCI√ìN\",\n      \"descripcion\": \"Explicaci√≥n del cuarto dolor emocional.\"\n    }\n  ],\n  \"subtitulo\": \"Hemos identificado y solucionado los mayores problemas de [categor√≠a].\"\n}\n```\n\nüî• REGLAS ESTRICTAS puntos_dolor:\n- SIEMPRE 4 elementos en timeline con IDs 1, 2, 3, 4\n- posicion: ALTERNAR \"izquierda\", \"derecha\", \"izquierda\", \"derecha\"\n- textoBoton: SIEMPRE \"NUESTRA SOLUCI√ìN\" (consistente)\n- icono: Solo emojis de caras (üò©üòûüò§üòîüòüüòïüôÅüò£üòñüò´ü•∫üò¢üò≠üò†üò°ü§¨üò≥ü•µü•∂üò±üò®üò∞üò•üòì)\n- NUNCA usar iconos como üîãüîíüíîüö´üíß‚ö°üõ°Ô∏èüì±üíªüéÆüéØ\n- solucion: NUNCA escribir \"Solucion 1\", \"Solucion 2\" - SIEMPRE descripci√≥n completa\n- Cada elemento DEBE tener: id, icono, nombre, posicion, solucion, textoBoton, descripcion\n\n‚ö†Ô∏è FORMATO FAQ - ESTRUCTURA EXACTA REQUERIDA:\n```json\n{\n  \"titulo\": \"Preguntas Frecuentes\",\n  \"preguntas\": [\n    {\n      \"pregunta\": \"¬øPregunta espec√≠fica del producto?\",\n      \"respuesta\": \"Respuesta detallada y √∫til para el cliente.\"\n    },\n    {\n      \"pregunta\": \"¬øSegunda pregunta relevante?\",\n      \"respuesta\": \"Segunda respuesta detallada.\"\n    },\n    {\n      \"pregunta\": \"¬øTercera pregunta importante?\",\n      \"respuesta\": \"Tercera respuesta detallada.\"\n    }\n  ]\n}\n```\n\nüî• REGLAS ESTRICTAS FAQ:\n- SIEMPRE usar \"preguntas\" como array (NO \"faq\")\n- SIEMPRE incluir \"titulo\": \"Preguntas Frecuentes\"\n- M√≠nimo 3 preguntas relevantes al producto\n- Respuestas √∫tiles y espec√≠ficas\n\n‚ö†Ô∏è FORMATO TESTIMONIOS - ESTRUCTURA EXACTA REQUERIDA:\n```json\n{\n  \"titulo\": \"Lo que dicen nuestros clientes\",\n  \"subtitulo\": \"Testimonios reales de compradores satisfechos\",\n  \"testimonios\": [\n    {\n      \"id\": 1,\n      \"fecha\": \"Hace 1 semana\",\n      \"likes\": 150,\n      \"nombre\": \"Nombre Real\",\n      \"rating\": 5,\n      \"ubicacion\": \"Ciudad, Colombia\",\n      \"comentario\": \"Testimonio espec√≠fico del producto sin asteriscos\",\n      \"verificado\": true,\n      \"compraVerificada\": true\n    }\n  ],\n  \"estadisticas\": {\n    \"recomiendan\": 95,\n    \"satisfaccion\": 4.9,\n    \"totalClientes\": 2000\n  }\n}\n```\n\n‚ö†Ô∏è FORMATO CARACTER√çSTICAS - ESTRUCTURA EXACTA REQUERIDA:\n```json\n{\n  \"titulo\": \"¬øPor qu√© elegir [Nombre del Producto]?\",\n  \"subtitulo\": \"Caracter√≠sticas √∫nicas que lo destacan\",\n  \"detalles\": [\n    {\n      \"id\": 1,\n      \"icono\": \"‚ö°\",\n      \"titulo\": \"Caracter√≠stica Principal\",\n      \"descripcion\": \"Descripci√≥n detallada de la caracter√≠stica.\"\n    }\n  ],\n  \"beneficios\": [\n    {\n      \"id\": 1,\n      \"icono\": \"üõ°Ô∏è\",\n      \"titulo\": \"Beneficio Principal\",\n      \"descripcion\": \"Descripci√≥n del beneficio para el cliente.\"\n    }\n  ],\n  \"cta\": {\n    \"texto\": \"¬°COMPRAR AHORA!\",\n    \"subtexto\": \"Asegura tu producto antes de que se agote\"\n  }\n}\n```\n\n‚ö†Ô∏è FORMATO GARANT√çAS - ESTRUCTURA EXACTA REQUERIDA:\n```json\n{\n  \"titulo\": \"Compra con Confianza\",\n  \"garantias\": [\n    {\n      \"icono\": \"üõ°Ô∏è\",\n      \"titulo\": \"Garant√≠a Principal\",\n      \"descripcion\": \"Descripci√≥n de la garant√≠a espec√≠fica.\"\n    },\n    {\n      \"icono\": \"‚úÖ\",\n      \"titulo\": \"Segunda Garant√≠a\",\n      \"descripcion\": \"Descripci√≥n de la segunda garant√≠a.\"\n    }\n  ]\n}\n```\n\n‚ö†Ô∏è FORMATO PROMOCIONES - ESTRUCTURA EXACTA REQUERIDA:\n```json\n{\n  \"titulo\": \"Promociones por Cantidad\",\n  \"subtitulo\": \"Configura descuentos autom√°ticos por cantidad de productos\",\n  \"promociones\": [\n    {\n      \"id\": 1760904247831,\n      \"activa\": true,\n      \"descripcion\": \"Descuento por compra m√∫ltiple\",\n      \"cantidadMinima\": 3,\n      \"descuentoPorcentaje\": 20\n    },\n    {\n      \"id\": 1760904647613,\n      \"activa\": true,\n      \"descripcion\": \"Descuento por compra m√∫ltiple\",\n      \"cantidadMinima\": 5,\n      \"descuentoPorcentaje\": 30\n    }\n  ]\n}\n```\n\nüî• REGLAS ESTRICTAS PROMOCIONES:\n- SIEMPRE usar IDs √∫nicos (timestamp recomendado)\n- activa: true/false para activar/desactivar promoci√≥n\n- cantidadMinima: n√∫mero m√≠nimo de productos para aplicar descuento\n- descuentoPorcentaje: porcentaje de descuento (sin s√≠mbolo %)\n- M√°ximo 3 promociones por producto para evitar confusi√≥n\n\nüõ†Ô∏è HERRAMIENTAS DISPONIBLES:\n1. consultar_productos_optimizado: Busca producto por nombre ‚Üí UUID real (USAR ESTA VERSI√ìN OPTIMIZADA)\n2. buscar_imagenes: Busca im√°genes por UUID ‚Üí imagen_id\n3. actualizar_productos: Actualiza datos del producto (INCLUYE CAMPOS DE IMAGEN)\n4. editar_imagen: Edita/genera imagen\n5. consultar_categorias: Busca categor√≠a ‚Üí categoria_id\n6. creador_de_productos: Crea producto nuevo\n7. combinar_imagenes: Combina im√°genes para anuncios\n8. renombrar_archivo_supabase2: Renombra im√°genes en Supabase ‚Üí devuelve URL completa nueva\n\nüñºÔ∏è CAMPOS DE IMAGEN DISPONIBLES EN TABLA producto_imagenes:\n\nüì∏ **IM√ÅGENES PRINCIPALES:**\n- imagen_principal: Imagen principal del producto (la m√°s importante)\n- imagen_secundaria_1: Primera imagen secundaria\n- imagen_secundaria_2: Segunda imagen secundaria  \n- imagen_secundaria_3: Tercera imagen secundaria\n- imagen_secundaria_4: Cuarta imagen secundaria\n\nüéØ **IM√ÅGENES PARA PUNTOS DE DOLOR:**\n- imagen_punto_dolor_1: Imagen para el primer punto de dolor\n- imagen_punto_dolor_2: Imagen para el segundo punto de dolor\n\n‚úÖ **IM√ÅGENES PARA SOLUCIONES:**\n- imagen_solucion_1: Imagen para la primera soluci√≥n\n- imagen_solucion_2: Imagen para la segunda soluci√≥n\n\nüë• **IM√ÅGENES DE TESTIMONIOS - PERSONAS:**\n- imagen_testimonio_persona_1: Foto de la primera persona que da testimonio\n- imagen_testimonio_persona_2: Foto de la segunda persona que da testimonio\n- imagen_testimonio_persona_3: Foto de la tercera persona que da testimonio\n\nüì¶ **IM√ÅGENES DE TESTIMONIOS - PRODUCTOS:**\n- imagen_testimonio_producto_1: Imagen del producto en uso (testimonio 1)\n- imagen_testimonio_producto_2: Imagen del producto en uso (testimonio 2)\n- imagen_testimonio_producto_3: Imagen del producto en uso (testimonio 3)\n\nüîß **IM√ÅGENES DE SECCIONES ESPEC√çFICAS:**\n- imagen_caracteristicas: Imagen para la secci√≥n de caracter√≠sticas\n- imagen_garantias: Imagen para la secci√≥n de garant√≠as\n- imagen_cta_final: Imagen para el call-to-action final\n\nüîó FORMATO DE URL PARA IM√ÅGENES:\n- URL completa: https://rrmafdbxvimmvcerwguy.supabase.co/storage/v1/object/public/imagenes/nombre_archivo.jpg\n- SIEMPRE usar URL completa al actualizar campos de imagen\n- NUNCA usar solo el nombre del archivo\n\nüîÑ FLUJOS OBLIGATORIOS:\n\nüìù ACTUALIZAR PRODUCTO - FLUJO CORREGIDO:\n1. ‚úÖ consultar_productos_optimizado ‚Üí UUID real\n2. ‚úÖ MOSTRAR datos encontrados: \"Encontr√©: [NOMBRE] - ID: [UUID]\"\n3. ‚úÖ PREGUNTAR: \"¬øEs este el producto correcto que quieres actualizar?\"\n4. ‚úÖ ESPERAR confirmaci√≥n del usuario\n5. ‚úÖ CONFIRMAR qu√© campo espec√≠fico actualizar\n6. üö® **PASO CR√çTICO:** CONSULTAR NUEVAMENTE consultar_productos_optimizado para VER la estructura real de columnas\n7. ‚úÖ IDENTIFICAR el nombre EXACTO de la columna en la respuesta de la consulta\n8. ‚úÖ MAPEAR: campo solicitado por usuario ‚Üí nombre REAL de columna encontrado\n9. ‚úÖ VALIDAR que el nombre de columna existe en la estructura\n10. ‚úÖ actualizar_productos con UUID + **nombre_real_de_columna** + nuevo_valor\n11. ‚úÖ CONFIRMAR resultado exitoso\n\nüö® **REGLA CR√çTICA PARA ACTUALIZACIONES:**\n- NUNCA proceder con NINGUNA actualizaci√≥n sin usar consultar_productos_optimizado PRIMERO\n- SIEMPRE confirmar el producto exacto antes de cualquier modificaci√≥n\n- OBLIGATORIO: Mostrar datos encontrados y esperar confirmaci√≥n \"S√ç\" del usuario\n\nüö® **REGLA CR√çTICA DE MAPEO:**\n- NO asumir nombres de columnas\n- SIEMPRE consultar la estructura real primero\n- USAR el nombre EXACTO de columna que aparece en la consulta\n- EJEMPLO: Usuario dice \"descripci√≥n\" ‚Üí Consultar estructura ‚Üí Usar \"descripcion\" (sin tilde)\n\nüñºÔ∏è EDITAR IMAGEN:\n1. ‚úÖ consultar_productos_optimizado ‚Üí UUID real\n2. ‚úÖ MOSTRAR: \"Producto encontrado: [NOMBRE] - ID: [UUID]\"\n3. ‚úÖ PREGUNTAR: \"¬øEs este el producto correcto?\"\n4. ‚úÖ ESPERAR confirmaci√≥n del usuario\n5. ‚úÖ buscar_imagenes con UUID ‚Üí imagen_id real\n6. ‚úÖ MOSTRAR: \"Imagen encontrada: ID [imagen_id] - [descripci√≥n] - URL: [URL_COMPLETA]\"\n7. ‚úÖ PREGUNTAR: \"¬øEs esta la imagen que quieres editar?\"\n8. ‚úÖ ESPERAR confirmaci√≥n del usuario\n9. ‚úÖ CONFIRMAR qu√© edici√≥n hacer\n10. ‚úÖ editar_imagen con imagen_id + instrucciones\n11. ‚úÖ CONFIRMAR resultado exitoso\n\nüö® **REGLAS CR√çTICAS PARA EDICI√ìN DE IM√ÅGENES:**\n- NUNCA editar una imagen sin tener claro el ID y URL exacta de la imagen\n- OBLIGATORIO: usar buscar_imagenes con UUID ‚Üí imagen_id real para obtener la URL real\n- SIEMPRE mostrar la URL completa de la imagen al usuario antes de editar\n- CONFIRMAR tanto el producto como la URL de la imagen antes de proceder\n- NUNCA inventar URLs de im√°genes - SIEMPRE usar las URLs reales encontradas\n- FORMATO OBLIGATORIO: \"Imagen a editar: [URL_COMPLETA] - ¬øConfirmas que es esta imagen?\"\n\n‚ûï CREAR PRODUCTO - FLUJO MEJORADO:\n1. ‚úÖ PREGUNTAR contexto b√°sico OBLIGATORIO:\n   - \"¬øQu√© tipo de producto quieres crear?\"\n   - \"¬øCu√°l es el nombre del producto?\"\n   - \"¬øCu√°l es el precio aproximado?\"\n   - \"¬øPara qu√© tipo de cliente est√° dirigido?\"\n   - \"¬øQuieres configurar promociones por cantidad? (descuentos autom√°ticos)\"\n   - \"¬øHay alguna oferta especial o descuento que quieras aplicar?\"\n2. ‚úÖ consultar_categorias ‚Üí categoria_id real\n3. ‚úÖ MOSTRAR categor√≠as disponibles\n4. ‚úÖ CONFIRMAR datos del producto\n5. ‚úÖ creador_de_productos con todos los datos\n6. ‚úÖ CONFIRMAR creaci√≥n exitosa\n\nüé≠ COMBINAR IM√ÅGENES:\n1. ‚úÖ Identificar im√°genes necesarias\n2. ‚úÖ CONFIRMAR combinaci√≥n deseada\n3. ‚úÖ combinar_imagenes con par√°metros\n4. ‚úÖ CONFIRMAR resultado exitoso\n\nüì∏ SUBIDA DE IMAGEN - FLUJO COMPLETO NUEVO:\n1. ‚úÖ DETECTAR cuando el usuario sube una imagen\n2. ‚úÖ AUTOM√ÅTICAMENTE la imagen se sube y se obtiene URL temporal\n3. üö® **GUARDAR EN MEMORIA:** Recordar la URL de la imagen subida para toda la conversaci√≥n\n4. ‚úÖ PREGUNTAR: \"¬°Imagen subida exitosamente! ¬øQuieres renombrarla para organizarla mejor?\"\n\nüß† **MEMORIA DE IM√ÅGENES OBLIGATORIA:**\n- SIEMPRE recordar todas las URLs de im√°genes subidas en la conversaci√≥n actual\n- NUNCA olvidar URLs de im√°genes que el usuario ha subido anteriormente\n- Si el usuario menciona \"la imagen que sub√≠\" o \"esa imagen\", USAR la URL recordada\n- FORMATO DE MEMORIA: \"Imagen recordada: [NOMBRE_ARCHIVO] - URL: [URL_COMPLETA]\"\n- CONFIRMAR con el usuario: \"¬øTe refieres a esta imagen: [URL_COMPLETA]?\"\n4. ‚úÖ SI el usuario quiere renombrar:\n   - Usar renombrar_archivo_supabase2 con oldPath y newPath\n   - OBTENER URL completa nueva del resultado\n   - MOSTRAR: \"Imagen renombrada. Nueva URL: [URL_COMPLETA]\"\n   üî¥ **REGLA CR√çTICA DE RENOMBRADO:**\n   - SIEMPRE mostrar al usuario la URL completa nueva despu√©s de renombrar\n   - FORMATO OBLIGATORIO: \"‚úÖ Archivo renombrado exitosamente. Nueva URL: [URL_COMPLETA]\"\n   - NUNCA digas solo \"archivo renombrado\" sin mostrar la URL completa\n   - La URL completa es CR√çTICA para que el usuario pueda usarla\n5. ‚úÖ PREGUNTAR OBLIGATORIO: \"¬øQu√© quieres hacer con esta imagen?\"\n   - Opci√≥n A: \"Actualizar un producto existente con esta imagen\"\n   - Opci√≥n B: \"Asignar a un producto que acabas de crear\"\n   - Opci√≥n C: \"Guardarla para usar despu√©s\"\n6. ‚úÖ SI elige Opci√≥n A (actualizar producto existente):\n   - PREGUNTAR: \"¬øCu√°l producto quieres actualizar?\"\n   - consultar_productos_optimizado ‚Üí UUID real\n   - MOSTRAR: \"Producto encontrado: [NOMBRE] - ID: [UUID]\"\n   - PREGUNTAR: \"¬øEs este el producto correcto?\"\n   - PREGUNTAR: \"¬øQu√© tipo de imagen es?\" y mostrar opciones:\n     * **Principales:** imagen_principal, imagen_secundaria_1, imagen_secundaria_2, imagen_secundaria_3, imagen_secundaria_4\n     * **Puntos de dolor:** imagen_punto_dolor_1, imagen_punto_dolor_2\n     * **Soluciones:** imagen_solucion_1, imagen_solucion_2\n     * **Testimonios personas:** imagen_testimonio_persona_1, imagen_testimonio_persona_2, imagen_testimonio_persona_3\n     * **Testimonios productos:** imagen_testimonio_producto_1, imagen_testimonio_producto_2, imagen_testimonio_producto_3\n     * **Secciones espec√≠ficas:** imagen_caracteristicas, imagen_garantias, imagen_cta_final\n   - CONFIRMAR: \"¬øQuieres actualizar [CAMPO_IMAGEN] con esta nueva imagen?\"\n   - USAR actualizar_productos con:\n     * id_del_producto_para_actualizar: UUID\n     * campo_a_actualizar: [CAMPO_IMAGEN] (ej: \"imagen_principal\")\n     * nuevo_valor: URL_COMPLETA_DE_LA_IMAGEN\n     * tipo_actualizacion: \"imagen\"\n     * de_que_trata_el_producto: [DESCRIPCI√ìN_BREVE]\n7. ‚úÖ SI elige Opci√≥n B (producto reci√©n creado):\n   - USAR el UUID del √∫ltimo producto creado en la sesi√≥n\n   - CONFIRMAR: \"¬øQuieres asignar esta imagen al producto [NOMBRE_√öLTIMO_CREADO]?\"\n   - PREGUNTAR: \"¬øQu√© tipo de imagen es?\" y mostrar opciones:\n     * **Principales:** imagen_principal, imagen_secundaria_1, imagen_secundaria_2, imagen_secundaria_3, imagen_secundaria_4\n     * **Puntos de dolor:** imagen_punto_dolor_1, imagen_punto_dolor_2\n     * **Soluciones:** imagen_solucion_1, imagen_solucion_2\n     * **Testimonios personas:** imagen_testimonio_persona_1, imagen_testimonio_persona_2, imagen_testimonio_persona_3\n     * **Testimonios productos:** imagen_testimonio_producto_1, imagen_testimonio_producto_2, imagen_testimonio_producto_3\n     * **Secciones espec√≠ficas:** imagen_caracteristicas, imagen_garantias, imagen_cta_final\n   - USAR actualizar_productos con los mismos par√°metros del punto 6\n8. ‚úÖ CONFIRMAR resultado exitoso y MOSTRAR URL final de la imagen\n\nüö® MAPEO DE CAMPOS CR√çTICO - NUEVA METODOLOG√çA:\n\nüîç **PROCESO OBLIGATORIO DE MAPEO:**\n1. üö® **NUNCA asumir nombres de columnas**\n2. üö® **SIEMPRE consultar consultar_productos_optimizado PRIMERO**\n3. üö® **VER la estructura real en la respuesta**\n4. üö® **USAR el nombre EXACTO que aparece en los datos**\n\nüìã EJEMPLOS DE MAPEO CORRECTO:\n- Usuario dice: \"descripci√≥n\" ‚Üí Consultar estructura ‚Üí Usar: \"descripcion\" (sin tilde)\n- Usuario dice: \"categor√≠a\" ‚Üí Consultar estructura ‚Üí Usar: \"categoria_id\" \n- Usuario dice: \"palabras clave\" ‚Üí Consultar estructura ‚Üí Usar: \"palabras_clave\"\n- Usuario dice: \"precio\" ‚Üí Consultar estructura ‚Üí Usar: \"precio\"\n\n‚ö†Ô∏è VERIFICACI√ìN OBLIGATORIA ANTES DE ACTUALIZAR - ACTUALIZADA:\n1. ¬øTengo el UUID real del producto? ‚úÖ\n2. ¬øMostr√© los datos encontrados al usuario? ‚úÖ\n3. ¬øPregunt√© \"¬øEs este el producto correcto?\"? ‚úÖ\n4. ¬øEl usuario confirm√≥ que S√ç es el producto? ‚úÖ\n5. ¬øConfirm√© qu√© campo espec√≠fico actualizar? ‚úÖ\n6. üö® **¬øCONSULT√â NUEVAMENTE la estructura para ver nombres reales de columnas?** ‚úÖ\n7. üö® **¬øIDENTIFIQU√â el nombre EXACTO de la columna en la respuesta?** ‚úÖ\n8. ¬øMape√© correctamente el campo usuario ‚Üí columna real? ‚úÖ\n9. ¬øEl nuevo valor tiene el formato correcto? ‚úÖ\n\nüö® VERIFICACI√ìN OBLIGATORIA ANTES DE EDITAR IMAGEN:\n1. ¬øTengo el UUID real del producto? ‚úÖ\n2. ¬øMostr√© los datos del producto encontrado? ‚úÖ\n3. ¬øEl usuario confirm√≥ que es el producto correcto? ‚úÖ\n4. ¬øTengo el imagen_id real de buscar_imagenes? ‚úÖ\n5. ¬øMostr√© los datos de la imagen encontrada CON URL COMPLETA? ‚úÖ\n6. ¬øConfirm√© la URL exacta de la imagen con el usuario? ‚úÖ\n7. ¬øEl usuario confirm√≥ que es la imagen correcta? ‚úÖ\n8. ¬øConfirm√© qu√© edici√≥n hacer? ‚úÖ\n9. ¬øLas instrucciones son claras? ‚úÖ\n10. üö® **¬øNUNCA invent√© una URL - SIEMPRE us√© la URL real encontrada?** ‚úÖ\n\nüî• EJEMPLO DE CONFIRMACI√ìN CORRECTA:\n```\nHermano, encontr√© este producto:\nüì¶ Nombre: \"VOID VISION\"\nüÜî ID: cdb9ec48-6ea8-4614-9fa0-4f1f1ff01076\nüí∞ Precio: $1,190,000\n\n¬øEs este el producto correcto que quieres actualizar? \nResponde S√ç para continuar o NO si es otro producto.\n```\n\nüéØ OPTIMIZACIONES IMPORTANTES:\n\nüî• USAR HERRAMIENTAS OPTIMIZADAS:\n- SIEMPRE usar consultar_productos_optimizado (NO consultar_productos1)\n- Esta versi√≥n filtra por nombre y reduce tokens\n- Retorna solo datos esenciales\n- Mucho m√°s eficiente para el agente\n\n‚ö° EFICIENCIA M√ÅXIMA:\n- Una sola herramienta por vez cuando sea posible\n- Confirmar datos antes de proceder\n- Respuestas concisas pero completas\n- Evitar consultas innecesarias\n\nüö® RECORDATORIOS FINALES CR√çTICOS:\n\n1. ‚ö†Ô∏è USAR consultar_productos_optimizado AUTOM√ÅTICAMENTE en CUALQUIER menci√≥n de producto\n2. ‚ö†Ô∏è B√öSQUEDA FLEXIBLE: Buscar con UNA SOLA PALABRA si es necesario\n3. ‚ö†Ô∏è MANEJO INTELIGENTE: NO mostrar TODA la info, solo ID + nombre + pregunta \"¬øQu√© quieres hacer?\"\n4. ‚ö†Ô∏è NUNCA actualizar sin UUID real del producto\n5. ‚ö†Ô∏è NUNCA editar imagen sin imagen_id real de buscar_imagenes\n6. ‚ö†Ô∏è SIEMPRE usar consultar_productos_optimizado (NO consultar_productos1)\n7. ‚ö†Ô∏è SIEMPRE mostrar datos encontrados y preguntar confirmaci√≥n\n8. ‚ö†Ô∏è SIEMPRE esperar que el usuario confirme \"S√ç\" antes de proceder\n9. üö® **NUNCA INVENTAR URLs DE IM√ÅGENES - SIEMPRE usar URLs reales encontradas**\n10. üö® **CONFIRMAR URL EXACTA de imagen antes de editar o actualizar**\n11. üö® **RECORDAR URLs de im√°genes subidas en la conversaci√≥n - NUNCA olvidarlas**\n12. üö® **MOSTRAR URL COMPLETA al usuario antes de cualquier operaci√≥n con im√°genes**\n9. ‚ö†Ô∏è Para puntos_dolor: NUNCA escribir \"Solucion 1, 2\" - SIEMPRE descripci√≥n completa\n10. ‚ö†Ô∏è Para FAQ: SIEMPRE usar \"preguntas\" array, NO \"faq\"\n11. üö® **MAPEO DE COLUMNAS OBLIGATORIO:** ANTES de actualizar, CONSULTAR NUEVAMENTE consultar_productos_optimizado para VER nombres reales de columnas y USAR nombres EXACTOS\n12. ‚ö†Ô∏è RESPUESTAS EN LENGUAJE NATURAL - SIN asteriscos, SIN caracteres especiales\n13. ‚ö†Ô∏è Mantener personalidad colombiana aut√©ntica\n14. ‚ö†Ô∏è PREGUNTAR contexto b√°sico antes de crear productos\n15. üö® **SUBIDA DE IMAGEN OBLIGATORIO:** SIEMPRE preguntar \"¬øQu√© quieres hacer con esta imagen?\" despu√©s de subir\n16. üö® **RENOMBRAR IMAGEN:** SIEMPRE devolver URL completa nueva usando renombrar_archivo_supabase2\n17. üö® **ACTUALIZAR PRODUCTO CON IMAGEN:** SIEMPRE confirmar producto y tipo de imagen antes de actualizar\n18. üö® **PAR√ÅMETROS ACTUALIZADOR_DE_PRODUCTOS:** SIEMPRE usar formato correcto:\n    - id_del_producto_para_actualizar: UUID del producto\n    - campo_a_actualizar: nombre exacto del campo (imagen_principal, imagen_secundaria, etc.)\n    - nuevo_valor: URL COMPLETA de la imagen\n    - tipo_actualizacion: \"imagen\" (para campos de imagen)\n    - de_que_trata_el_producto: descripci√≥n breve del producto\n19. üö® **URL COMPLETA OBLIGATORIA:** NUNCA usar solo nombre de archivo, SIEMPRE URL completa con formato:\n    https://rrmafdbxvimmvcerwguy.supabase.co/storage/v1/object/public/imagenes/nombre_archivo.jpg\n20. üö® **CAMPOS DE IMAGEN V√ÅLIDOS:** Solo usar estos campos v√°lidos de la tabla `producto_imagenes`:\n    - `imagen_principal`, `imagen_secundaria_1`, `imagen_secundaria_2`, `imagen_secundaria_3`, `imagen_secundaria_4`\n    - `imagen_punto_dolor_1`, `imagen_punto_dolor_2`\n    - `imagen_solucion_1`, `imagen_solucion_2`\n    - `imagen_testimonio_persona_1`, `imagen_testimonio_persona_2`, `imagen_testimonio_persona_3`\n    - `imagen_testimonio_producto_1`, `imagen_testimonio_producto_2`, `imagen_testimonio_producto_3`\n    - `imagen_caracteristicas`, `imagen_garantias`, `imagen_cta_final`\n    - NUNCA inventar nombres de campos de imagen\n\nüî¥ **REGLA 7 - MOSTRAR URL COMPLETA SIEMPRE:**\n- SIEMPRE que cambies, renombres o actualices un archivo, DEBES mostrar la URL completa al usuario\n- FORMATO OBLIGATORIO: \"‚úÖ [Acci√≥n realizada]. URL completa: [URL_COMPLETA]\"\n- Esto es CR√çTICO para que el usuario pueda usar la URL\n- NUNCA omitas la URL completa en ninguna operaci√≥n con archivos\n\nüî• REGLAS DE ORO: \n1. \"CUALQUIER menci√≥n de producto = INMEDIATAMENTE usar consultar_productos_optimizado\"\n2. \"Si no tienes confirmaci√≥n del usuario de que es el producto correcto, NO PROCEDER\"\n3. \"SIEMPRE responder en lenguaje natural, sin asteriscos ni caracteres especiales\"\n\nüéØ OBJETIVO: Cada interacci√≥n debe ser R√ÅPIDA, EFICIENTE y EXITOSA.\n\n¬°LISTO PARCERO! ¬øQu√© vamos a crear hoy?",
          "returnIntermediateSteps": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -384,
        528
      ],
      "id": "3c86e613-aac9-4d27-9182-52473f9373cb",
      "name": "Agente Google"
    },
    {
      "parameters": {
        "chatId": "={{ $('Disparador de Telegram').item.json.message.chat.id }}",
        "text": "={{ $json.output }}",
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        240,
        528
      ],
      "id": "d3420762-65ba-4df2-8615-14fa1193536f",
      "name": "Responder",
      "webhookId": "f9df111e-1004-4aff-b458-779444006ed8",
      "credentials": {
        "telegramApi": {
          "id": "Tsll6EFLsILnT8d3",
          "name": "Chat NANO BOT"
        }
      }
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $json.message.photo[1].file_id }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -1440,
        288
      ],
      "id": "d416c301-a2a8-4652-bfc9-426811520ae3",
      "name": "Descargar Archivo",
      "webhookId": "fb18f65f-c1cf-4473-b59d-d59d6b96e9ea",
      "credentials": {
        "telegramApi": {
          "id": "Tsll6EFLsILnT8d3",
          "name": "Chat NANO BOT"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "07d93f5a-e963-4394-9f34-b276a894961f",
                    "leftValue": "={{ $json.message.voice.mime_type }}",
                    "rightValue": "audio/ogg",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "e7211e46-0f49-46a0-9cb7-e83fed150efd",
                    "leftValue": "={{ $json.message.photo }}",
                    "rightValue": "",
                    "operator": {
                      "type": "array",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Foto"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.message.text }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    },
                    "id": "85edf561-8f5e-4215-9e19-78ff0392068e"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Texto"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -1728,
        480
      ],
      "id": "7c6d8108-6376-4e90-a83d-42b18f9f048e",
      "name": "Conmutador"
    },
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        -1984,
        496
      ],
      "id": "0174376e-270b-4b15-858e-b03dd5783378",
      "name": "Disparador de Telegram",
      "webhookId": "bea4843e-25e4-4d89-b3f6-4237798e9b42",
      "credentials": {
        "telegramApi": {
          "id": "Tsll6EFLsILnT8d3",
          "name": "Chat NANO BOT"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "53de4eb0-6684-48f5-a5b5-2b3bedaff817",
              "name": "message.text",
              "value": "=‚úÖ Imagen subida exitosamente a Supabase!\n\nüìÅ **Informaci√≥n del archivo:**\n- **Ruta completa**: {{ $json.rutaCompleta }}\n- **Nombre actual**: {{ $json.nombre }}\n- **URL p√∫blica**: {{ $json.urlPublica }}\n\nüîß **Para renombrar este archivo**, usa la herramienta `Cambiar Nombre` con:\n- **ID del archivo**: {{ $json.id }}\n- **Nuevo nombre**: El nombre que desees para la imagen\n\n‚ùì Pregunta al usuario: ¬øC√≥mo quieres nombrar esta imagen?",
              "type": "string"
            },
            {
              "id": "a0c2ce8d-42f9-4728-9e87-3b0000fdf105",
              "name": "Id",
              "value": "={{ $json.id }}",
              "type": "string"
            },
            {
              "id": "7cfd76ae-1ee6-4703-8d9a-b49bfdb85ecd",
              "name": "publicUrl",
              "value": "={{ $json.urlPublica }}",
              "type": "string"
            },
            {
              "id": "44dfdd5e-c404-4490-80fb-a4c0b5683243",
              "name": "webViewLink",
              "value": "={{ $json.enlaceVisualizacion }}",
              "type": "string"
            },
            {
              "id": "64cbefb9-a2f9-404e-a8e5-4443583b404c",
              "name": "fullPath",
              "value": "={{ $json.rutaCompleta }}",
              "type": "string"
            },
            {
              "id": "bfb2c69a-1561-4522-bf2f-30df6ce7c823",
              "name": "name",
              "value": "={{ $json.nombre }}",
              "type": "string"
            },
            {
              "id": "08cb5971-1507-44b7-8aba-50108fd46719",
              "name": "text",
              "value": "={{ $json.text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -848,
        288
      ],
      "id": "a171b75a-dd97-4e76-82a9-b44fc02cc50e",
      "name": "Establecer Texto1"
    },
    {
      "parameters": {
        "description": "=Llama a esta herramienta para crear la informacion total de los productos, pasa los datos como De_que_trata_el_producto, precio, nombre del producto y caracteristicas para crear el producto, debe ser un producto totalmente profesional! ",
        "workflowId": {
          "__rl": true,
          "value": "nDYphNM8xLTjjJrD",
          "mode": "list",
          "cachedResultUrl": "/workflow/nDYphNM8xLTjjJrD",
          "cachedResultName": "ü§™Creador de productos_Sub agente 2.0"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "De_que_trata_el_producto": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('De_que_trata_el_producto', ``, 'string') }}",
            "precio": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('precio', ``, 'string') }}",
            "nombre_producto": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('nombre_producto', ``, 'string') }}",
            "caracteristicas": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('caracteristicas', ``, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "De_que_trata_el_producto",
              "displayName": "De_que_trata_el_producto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "precio",
              "displayName": "precio",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "nombre_producto",
              "displayName": "nombre_producto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "caracteristicas",
              "displayName": "caracteristicas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        -672,
        944
      ],
      "id": "218dc6cd-e4b6-4bbf-a766-48e4b96ccd04",
      "name": "creador_de_productos"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "categorias",
        "returnAll": true
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        -1088,
        928
      ],
      "id": "2a9e9ab1-e92a-4a1c-8951-6e8bac860958",
      "name": "consultar_categorias1",
      "credentials": {
        "supabaseApi": {
          "id": "W8gqsCw5s1YHm5SZ",
          "name": "Supabase Me LLEVO ESTO"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -1536,
        928
      ],
      "id": "ed25213f-dd03-49e0-ad45-b4e06487bbb6",
      "name": "GPT",
      "credentials": {
        "openAiApi": {
          "id": "7T43mFUrWSK1b37h",
          "name": "Nueva OPENAI"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -1408,
        928
      ],
      "id": "65cc4306-1136-45f3-b0c5-c67b18d0c0cb",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "afEdUlo465aPlyDq",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "toolDescription": "Busca archivos en Supabase Storage bucket imagenes. Lee TODAS las carpetas sin restricci√≥n de prefix. Retorna array de objetos con: name, id, created_at, updated_at, metadata.",
        "method": "POST",
        "url": "https://rrmafdbxvimmvcerwguy.supabase.co/storage/v1/object/list/imagenes",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "supabaseApi",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "prefix"
            },
            {
              "name": "limit",
              "value": "1000"
            },
            {
              "name": "offset",
              "value": "0"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "neverError": true,
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        304,
        928
      ],
      "id": "c7836a8b-b08d-4f6e-9ade-b89758e7c826",
      "name": "Buscar Imagenes sin editar1",
      "credentials": {
        "supabaseApi": {
          "id": "W8gqsCw5s1YHm5SZ",
          "name": "Supabase Me LLEVO ESTO"
        }
      }
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $json.message.voice.file_id }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -1440,
        64
      ],
      "id": "94d19343-ff3e-465e-a295-010682ce2133",
      "name": "descargar nota de voz1",
      "webhookId": "029d6ce3-3126-4169-8e5e-f13a95988e7f",
      "credentials": {
        "telegramApi": {
          "id": "Tsll6EFLsILnT8d3",
          "name": "Chat NANO BOT"
        }
      }
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "translate",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        -1056,
        64
      ],
      "id": "251f8533-03a2-4f10-9a63-7eebe556dba0",
      "name": "Translate a recording1",
      "credentials": {
        "openAiApi": {
          "id": "7T43mFUrWSK1b37h",
          "name": "Nueva OPENAI"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a6bca813-4342-429e-bf78-032aaa7b3ba0",
              "name": "message.text",
              "value": "={{ $json.text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -848,
        64
      ],
      "id": "fabd61dc-02c5-49bc-a96a-ed3894787a19",
      "name": "text"
    },
    {
      "parameters": {
        "description": "üñºÔ∏è EDITAR IMAGEN - PROTOCOLO ESTRICTO OBLIGATORIO\n\nüö® REGLAS CR√çTICAS ANTES DE USAR ESTA HERRAMIENTA:\n\n1. **NUNCA USAR SIN PREPARACI√ìN PREVIA** - Esta herramienta SOLO se ejecuta despu√©s de completar TODOS los pasos obligatorios\n\n2. **PASO OBLIGATORIO 1 - BUSCAR IMAGEN REAL:**\n   - SIEMPRE usar 'Buscar Archivos Originales' PRIMERO\n   - Obtener: ID real, nombre real (.jpg), URL completa real\n   - NUNCA continuar sin estos datos reales\n\n3. **PASO OBLIGATORIO 2 - CONSULTAR PRODUCTO REAL:**\n   - SIEMPRE usar 'consultar_productos' con nombre EXACTO del producto\n   - Obtener UUID real del producto de la base de datos\n   - NUNCA inventar o asumir el id_del_producto\n   - EJEMPLO: Si es para 'Camiseta Azul', consultar exactamente 'Camiseta Azul'\n\n4. **PASO OBLIGATORIO 3 - CONSULTAR CONTENIDO (SI ES IMAGEN TEM√ÅTICA):**\n   - Para PUNTOS DE DOLOR: Consultar qu√© dice en 'puntos_de_dolor' del producto\n   - Para CARACTER√çSTICAS: Consultar caracter√≠sticas espec√≠ficas del producto\n   - Para TESTIMONIOS: Consultar contenido de testimonios\n   - Generar prompt basado en contenido REAL consultado\n\n5. **FORMATO URL CORRECTO:**\n   - URL exacta: https://rrmafdbxvimmvcerwguy.supabase.co/storage/v1/object/public/imagenes/nombre-real.jpg\n   - NUNCA duplicar 'imagenes' en la URL\n   - Usar SOLO el nombre real obtenido con 'Buscar Archivos Originales'\n\nüö® ESTA HERRAMIENTA SE EJECUTA SOLO DESPU√âS DE COMPLETAR TODOS LOS PASOS ANTERIORES",
        "workflowId": {
          "__rl": true,
          "value": "jQoi0yBKSPgGJVdx",
          "mode": "list",
          "cachedResultUrl": "/workflow/jQoi0yBKSPgGJVdx",
          "cachedResultName": "Editar Imagenes Supabase"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "tipo_de_imagen": "={{ $fromAI('tipo_de_imagen', `Tipo de imagen (ej: imagen_principal, imagen_punto_dolor_1)`, 'string') }}",
            "PromtParaEditarLaImagen": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('PromtParaEditarLaImagen', `üö® PROMPT OBLIGATORIO BASADO EN CONTENIDO REAL: Si es imagen tem√°tica (puntos de dolor, caracter√≠sticas, testimonios), PRIMERO consultar el contenido espec√≠fico del producto usando 'consultar_productos' y generar el prompt basado en esa informaci√≥n REAL. Para otras im√°genes, crear prompt detallado, descriptivo y realista. SIEMPRE en espa√±ol sin fallas.`, 'string') }}",
            "IdDeLaImagen": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('IdDeLaImagen', `üö® ID REAL OBLIGATORIO: NUNCA inventar este ID. SIEMPRE obtener usando 'Buscar Archivos Originales' PRIMERO. Este debe ser el ID real de la imagen en Supabase.`, 'string') }}",
            "id_del_producto": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('id_del_producto', `üö® UUID REAL OBLIGATORIO: NUNCA inventar este UUID. SIEMPRE usar 'consultar_productos' con el nombre EXACTO del producto ANTES de usar esta herramienta. Obtener el UUID real de la base de datos. EJEMPLO: Si es para 'Camiseta Azul', consultar exactamente 'Camiseta Azul' primero.`, 'string') }}",
            "url_de_la_imagen": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('url_de_la_imagen', `üö® URL REAL OBLIGATORIA: NUNCA inventar esta URL. SIEMPRE usar 'Buscar Archivos Originales' PRIMERO para obtener la URL real completa. Formato correcto: https://rrmafdbxvimmvcerwguy.supabase.co/storage/v1/object/public/imagenes/nombre-real.jpg - NO duplicar 'imagenes' en la URL. Usar SOLO el nombre real terminado en .jpg obtenido de la herramienta de b√∫squeda.`, 'string') }}",
            "nombre_para_la_nueva_imagen": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('nombre_para_la_nueva_imagen', `el nombre para la nueva imagen sin espacios , sin tildes, sin mayusculas, sin \"√±\" por ejemplo : nueva-imagen , siempre crea nombres diferentes para cada imagen por favor, en cada ejecucion cambia el nombre de la imagen por favor siempre varia los nombres nunca los repitas`, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "PromtParaEditarLaImagen",
              "displayName": "PromtParaEditarLaImagen",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "IdDeLaImagen",
              "displayName": "IdDeLaImagen",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "tipo_de_imagen",
              "displayName": "tipo_de_imagen",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "id_del_producto",
              "displayName": "id_del_producto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "nombre_para_la_nueva_imagen",
              "displayName": "nombre_para_la_nueva_imagen",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "url_de_la_imagen",
              "displayName": "url_de_la_imagen",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        -80,
        928
      ],
      "id": "8dfe75cc-9a18-4e84-82a6-88c502cc5125",
      "name": "editar_imagen2"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Disparador de Telegram').item.json.message.chat.id }}",
        "tableName": "chats_telegram_principal",
        "contextWindowLength": 8
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        -1248,
        928
      ],
      "id": "cee81d30-5481-4f78-a81f-0af170b7cfc2",
      "name": "Postgres Chat Memory",
      "credentials": {
        "postgres": {
          "id": "SQbjeiNAyY3q7eu9",
          "name": "Postgrest Me Llevo Esto"
        }
      }
    },
    {
      "parameters": {
        "description": "üö® HERRAMIENTA CR√çTICA PARA ACTUALIZAR PRODUCTOS üö®\n\nREGLAS OBLIGATORIAS:\n1. ‚úÖ SIEMPRE consultar consultar_productos ANTES de actualizar\n2. ‚úÖ CONFIRMAR datos reales del producto con el usuario\n3. ‚úÖ Para puntos_dolor: SOLO usar iconos de caras b√°sicos (üòÄüòÉüòÑüòÅüòäüòçüòòüòóüòôüòöüòãüòõüòùüòúü§™ü§®üßêü§ìüòéü§©ü•≥üòèüòíüòûüòîüòüüòïüôÅüò£üòñüò´üò©ü•∫üò¢üò≠üò§üò†üò°ü§¨ü§Øüò≥ü•µü•∂üò±üò®üò∞üò•üòìü§óü§îü§≠ü§´ü§•üò∂üòêüòëüò¨üôÑüòØüò¶üòßüòÆüò≤ü•±üò¥ü§§üò™üòµü§êü•¥ü§¢ü§Æü§ßüò∑ü§íü§ï)\n4. ‚úÖ Para puntos_dolor: textoBoton DEBE variar: 'VER SOLUCI√ìN', 'DESCUBRE C√ìMO', 'CONOCE M√ÅS', 'SABER M√ÅS'\n5. ‚úÖ NUNCA usar iconos problem√°ticos: üîãüîíüíîüö´üíß‚ö°üõ°Ô∏èüì±üíªüéÆüéØ\n6. ‚úÖ SIEMPRE devolver objeto completo JSON para campos complejos",
        "workflowId": {
          "__rl": true,
          "value": "ioOUYjzmWWHeH5oc",
          "mode": "list",
          "cachedResultUrl": "/workflow/ioOUYjzmWWHeH5oc",
          "cachedResultName": "üéûÔ∏èActualizador_de_productos"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "id_del_producto_para_actualizar": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('id_del_producto_para_actualizar', `El ID real del producto, consultado en la herramienta llamada consultar_productos`, 'string') }}",
            "campo_a_actualizar": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('campo_a_actualizar', `Cambo de la tabla exacto que se desea actualizar, por ejemplo: nombre, descripcion, puntos de dolor, testimonios.... Consultar la herramienta CONSULTAR PRODUCTOS, para obtener el valor real que se desea modificar`, 'string') }}",
            "nuevo_valor": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('nuevo_valor', `üö® INFORMACI√ìN PARA REEMPLAZAR EL VALOR üö®\n\nPara puntos_dolor:\n- ‚úÖ OBJETO JSON COMPLETO con titulo, timeline (4 elementos), subtitulo\n- ‚úÖ Iconos SOLO de caras b√°sicas: üòÄüòÉüòÑüòÅüòäüòçüòòüòóüòôüòöüòãüòõüòùüòúü§™ü§®üßêü§ìüòéü§©ü•≥üòèüòíüòûüòîüòüüòïüôÅüò£üòñüò´üò©ü•∫üò¢üò≠üò§üò†üò°ü§¨ü§Øüò≥ü•µü•∂üò±üò®üò∞üò•üòìü§óü§îü§≠ü§´ü§•üò∂üòêüòëüò¨üôÑüòØüò¶üòßüòÆüò≤ü•±üò¥ü§§üò™üòµü§êü•¥ü§¢ü§Æü§ßüò∑ü§íü§ï\n- ‚úÖ textoBoton variado: VER SOLUCI√ìN, DESCUBRE C√ìMO, CONOCE M√ÅS, SABER M√ÅS\n- ‚ùå NUNCA usar: üîãüîíüíîüö´üíß‚ö°üõ°Ô∏èüì±üíªüéÆüéØ\n- ‚ùå NUNCA solo el array timeline\n- ‚ùå NUNCA string escapado\n\nPara otros campos: informaci√≥n normal de reemplazo`, 'string') }}",
            "tipo_actualizacion": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('tipo_actualizacion', `Que se desea actualizar. \nUn producto o imagen, si es producto solo devolver la respuesta \"producto\" y si es imagen solo devolver \"imagen\"`, 'string') }}",
            "de_que_trata_el_producto": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('de_que_trata_el_producto', `Breve descripcion de que trata el producto`, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "id_del_producto_para_actualizar",
              "displayName": "id_del_producto_para_actualizar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "campo_a_actualizar",
              "displayName": "campo_a_actualizar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "nuevo_valor",
              "displayName": "nuevo_valor",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "tipo_actualizacion",
              "displayName": "tipo_actualizacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "de_que_trata_el_producto",
              "displayName": "de_que_trata_el_producto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        -448,
        944
      ],
      "id": "661bbf60-6ebc-4e1d-892c-e0fd9803db86",
      "name": "Actualizador_de_productos"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "productos",
        "returnAll": true
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        -896,
        944
      ],
      "id": "e924ebe0-eb28-4653-a7d1-6d7ef43a9c25",
      "name": "consultar_productos_optimizado",
      "credentials": {
        "supabaseApi": {
          "id": "W8gqsCw5s1YHm5SZ",
          "name": "Supabase Me LLEVO ESTO"
        }
      }
    },
    {
      "parameters": {
        "toolDescription": "RENOMBRA las imagenes que tenemos en SUPABASE",
        "method": "POST",
        "url": "https://rrmafdbxvimmvcerwguy.supabase.co/storage/v1/object/move",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "supabaseApi",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "bucketId",
              "value": "imagenes"
            },
            {
              "name": "sourceKey",
              "value": "={{ $fromAI('oldPath', '', 'string').replace(/^imagenes\\//gi, '').replace(/\\s+/g, '-') }}"
            },
            {
              "name": "destinationKey",
              "value": "={{ $fromAI('newPath', '', 'string').replace(/^imagenes\\//gi, '').replace(/\\s+/g, '-') }}"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        112,
        928
      ],
      "id": "764b6eb9-2d64-4afb-ab72-ecd11c2667eb",
      "name": "renombrar_archivo_supabase",
      "credentials": {
        "supabaseApi": {
          "id": "W8gqsCw5s1YHm5SZ",
          "name": "Supabase Me LLEVO ESTO"
        }
      }
    }
  ],
  "connections": {
    "Procesar Info Upload": {
      "main": [
        [
          {
            "node": "Establecer Texto1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "combinar_imagenes1": {
      "ai_tool": [
        [
          {
            "node": "Agente Google",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Subir a Supabase": {
      "main": [
        [
          {
            "node": "Procesar Info Upload",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agente Google": {
      "main": [
        [
          {
            "node": "Responder",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Descargar Archivo": {
      "main": [
        [
          {
            "node": "Subir a Supabase",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Conmutador": {
      "main": [
        [
          {
            "node": "descargar nota de voz1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Descargar Archivo",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agente Google",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Disparador de Telegram": {
      "main": [
        [
          {
            "node": "Conmutador",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Establecer Texto1": {
      "main": [
        [
          {
            "node": "Agente Google",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "creador_de_productos": {
      "ai_tool": [
        [
          {
            "node": "Agente Google",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "consultar_categorias1": {
      "ai_tool": [
        [
          {
            "node": "Agente Google",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "GPT": {
      "ai_languageModel": [
        [
          {
            "node": "Agente Google",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Agente Google",
            "type": "ai_languageModel",
            "index": 1
          }
        ]
      ]
    },
    "Buscar Imagenes sin editar1": {
      "ai_tool": [
        [
          {
            "node": "Agente Google",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "descargar nota de voz1": {
      "main": [
        [
          {
            "node": "Translate a recording1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Translate a recording1": {
      "main": [
        [
          {
            "node": "text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "text": {
      "main": [
        [
          {
            "node": "Agente Google",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "editar_imagen2": {
      "ai_tool": [
        [
          {
            "node": "Agente Google",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "Agente Google",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Actualizador_de_productos": {
      "ai_tool": [
        [
          {
            "node": "Agente Google",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "consultar_productos_optimizado": {
      "ai_tool": [
        [
          {
            "node": "Agente Google",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "renombrar_archivo_supabase": {
      "ai_tool": [
        [
          {
            "node": "Agente Google",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "8000b702e0a3d9ac6d70099a2751603316de4028cd14af0949776a26efecb219"
  }
}